"use strict";const cardInner=document.querySelector(".cart__inner"),ratings=document.querySelectorAll(".rating"),rangeInput=document.querySelectorAll(".range__input input"),progress=document.querySelector(".range .progress"),priceInput=document.querySelectorAll(".selection__inputs input"),btnCart=document.querySelector(".btn__icon"),btnMore=document.querySelector(".btn__load-more"),btnBack=document.querySelector(".btn__back"),btnFilter=document.querySelector(".filter__icon"),btnScroll=document.querySelector(".btn__scroll"),btnsAdd=document.querySelectorAll(".btn__add"),btnBuy=document.querySelector(".btn__buy"),btnsView=document.querySelectorAll(".btn__view"),btnClose=document.querySelector(".btn__close"),btnsDelete=document.querySelectorAll(".btn__delete"),btnCheckout=document.querySelector(".btn__checkout"),btnsCheckbox=document.querySelectorAll(".checkbox"),titleEmpty=document.querySelector(".title__empty"),itemList=document.querySelector(".inner__items"),items=document.querySelectorAll(".inner__item"),itemsTitle=document.querySelectorAll(".item__title"),inputSearch=document.querySelector(".input__search"),popup=document.querySelector(".popup"),selectContainer=document.querySelector(".select__container"),cardsContainer=document.querySelectorAll(".card"),cards=document.querySelectorAll(".card"),filterMenu=document.querySelector(".filter"),priceContainer=document.querySelector(".price__container"),cardContainer=document.querySelector(".card__container"),cardDescription=document.querySelector(".card__description"),ratingValues=document.querySelectorAll(".rating__value");let selectedValue,priceGap=100,priceInner=document.querySelector(".total__price span"),counters=document.querySelectorAll(".counter"),numberForProducts=0,priceCount=0,MasCard=[],Massive=[],selection=[],arr=[],iteration=0,item=0;cards.forEach((e=>{item>3&&(MasCard.push(e),e.style.display="none"),item++})),window.onload=function(){for(let e=0;e<cards.length;e++){const t=cards[e];t.querySelector(".btn__view").onclick=function(){let e=t.querySelector(".card__img img").src,n=t.querySelector(".card__img img").alt,r=t.querySelector(".card__title").textContent,o=t.querySelector(".card__price").textContent,c=cardContainer.querySelector(".card__img img"),l=cardContainer.querySelector(".card__img img"),a=cardContainer.querySelector(".card__title"),i=document.querySelector(".description__title"),s=cardContainer.querySelector(".card__price");c.src=e,l.alt=n,a.textContent=r,i.textContent=r,s.textContent=o,popup.classList.add("show");let u=new XMLHttpRequest,d="popup="+r;u.onreadystatechange=function(){4==u.readyState&&200==u.status&&(mySelect.innerHTML="",JSON.parse(u.response)[0].selectValue.split(", ").forEach((e=>{let t=document.createElement("option");t.value=e,t.textContent=e,mySelect.append(t)})))},u.open("POST","assets/php/popup/getOptions.php",!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.send(d);let p=new XMLHttpRequest,m="desc="+r;p.onreadystatechange=function(){if(4==p.readyState&&200==p.status){let e=JSON.parse(p.response)[0].description;cardDescription.textContent=e}},p.open("POST","assets/php/popup/getDescription.php",!0),p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),p.send(m)}}},btnClose.onclick=function(){popup.classList.remove("show")},btnCart.onclick=function(){btnCart.classList.add("open");for(let e=0;e<counters.length;e++){counters[e].style.display="none"}},btnBack.onclick=function(){btnCart.classList.remove("open");for(let e=0;e<counters.length;e++){counters[e].style.display="block"}},btnFilter.onclick=function(){btnFilter.classList.toggle("toggle"),btnFilter.classList.contains("toggle")?filterMenu.style.display="inline-block":filterMenu.style.display="none"},btnMore.onclick=function(){for(let e=0;e<MasCard.length;e++)e<4&&(MasCard[e].style.display="flex");MasCard.splice(0,4),0===MasCard.length&&(btnMore.style.display="none")},itemList.addEventListener("click",deleteItem);for(let e of btnsCheckbox){let t=e.value;e.onchange=function(){e.checked?cardsContainer.forEach((function(e){-1==e.textContent.search(t)?e.classList.add("hide"):e.classList.remove("hide")})):cardsContainer.forEach((function(e){e.classList.remove("hide"),btnMore.style.display="none"}))}}function initRatings(){let e,t;for(let e=0;e<ratings.length;e++){n(ratings[e])}function n(e){r(e),o(),e.classList.contains("rating_set")&&function(e){const n=e.querySelectorAll(".rating__item");for(let c=0;c<n.length;c++){const l=n[c];l.addEventListener("mouseenter",(function(t){r(e),o(l.value)})),l.addEventListener("mouseleave",(function(e){o()})),l.addEventListener("click",(function(n){r(e),t.innerHTML=c+1,o()}))}}(e)}function r(n){e=n.querySelector(".rating__active"),t=n.querySelector(".rating__value")}function o(n=t.innerHTML){const r=n/.05;e.style.width=`${r}%`}}function deleteItem(e){let t=e.target;if("btn__delete"===t.className&&t.classList.contains("btn__delete")){const e=t.parentElement;let n=e.querySelector("h3.price__count").textContent,r=e.querySelector(".item__title").textContent,o=document.querySelector(".total__price span");if(e.remove(),numberForProducts--,numberForProducts<9&&(counters[0].textContent--,counters[1].textContent--),0===numberForProducts&&(btnCheckout.style.display="none",titleEmpty.style.display="block",priceContainer.style.display="none"),9===numberForProducts){let e=counters[1].textContent.replace("+","");counters[1].textContent=e,counters[0].textContent=e}let c=+n.replace("$","");priceCount-=c;let l=JSON.parse(localStorage.getItem("items")),a=l.title,i=l.totalPrice;i-=c,priceCount=i,o.textContent=priceCount+"$";let s=a.indexOf(r);arr.splice(s,1),arr.join(",");const u={title:arr.map((e=>e.title+" "+e.option)).toString(),totalPrice:priceCount};localStorage.setItem("items",JSON.stringify(u))}}inputSearch.oninput=function(){const e=document.querySelectorAll(".card");let t=inputSearch.value.trim().toLowerCase();""!=t?e.forEach((function(e){-1==e.textContent.toLowerCase().search(t)?e.classList.add("hide"):e.classList.remove("hide")})):e.forEach((function(e){e.classList.remove("hide"),btnMore.style.display="none"}))},selectContainer.onchange=function(){let e=selectContainer.value,t=[],n=[],r=[];for(let e=ratingValues.length-1;e>=0;e--)n.push(ratingValues[e].value),r.push(ratingValues[e].value),t.push({card:cardsContainer[e],rate:ratingValues[e].value});if("high to low"===e){n.sort((function(e,t){return t-e}));for(let e=0;e<n.length;e++)t.map((t=>{t.rate===n[e]&&(t.card.style.order=n.indexOf(n[e]))}))}else if("low to high"===e){n.sort((function(e,t){return e-t}));for(let e=0;e<n.length;e++)t.map((t=>{t.rate===n[e]&&(t.card.style.order=n.indexOf(n[e]))}))}else for(let e=0;e<r.length;e++)t.map((t=>{t.rate===r[e]&&(t.card.style.order=r.indexOf(r[e]))}))},ratings.length>0&&initRatings(),priceInput.forEach((e=>{e.addEventListener("input",(e=>{let t=parseInt(priceInput[0].value),n=parseInt(priceInput[1].value);n-t>=priceGap&&n<=rangeInput[1].max&&("input__min"===e.target.className?(rangeInput[0].value=t,progress.style.left=t/rangeInput[0].max*100+"%"):(rangeInput[1].value=n,progress.style.right=100-n/rangeInput[1].max*100+"%"));let r=[];cards.forEach((e=>{r.push({el:e,price:e.querySelector(".card__price")})}));for(let e=0;e<r.length;e++){let o=+r[e].price.textContent.replace("$","");r[e].el.style.display=o<=n&&o>=t?"flex":"none"}}))})),rangeInput.forEach((e=>{e.addEventListener("input",(e=>{let t=parseInt(rangeInput[0].value),n=parseInt(rangeInput[1].value);n-t<priceGap?"range__min"===e.target.className?rangeInput[0].value=n-priceGap:rangeInput[1].value=t+priceGap:(priceInput[0].value=t,priceInput[1].value=n,progress.style.left=t/rangeInput[0].max*100+"%",progress.style.right=100-n/rangeInput[1].max*100+"%");let r=[];cards.forEach((e=>{r.push({el:e,price:e.querySelector(".card__price")})}));for(let e=0;e<r.length;e++){let t=+r[e].price.textContent.replace("$","");t<=priceInput[1].value&&t>=priceInput[0].value?r[e].el.style.display="flex":r[e].el.style.display="none"}}))}));for(let e=0;e<cards.length;e++){const t=cards[e];t.querySelector(".btn__add").addEventListener("click",(()=>{addCart(t)}))}function addCart(e){let t=document.createElement("a"),n=e.querySelector(".card__img img").src,r=e.querySelector(".card__img img").alt,o=e.querySelector(".card__title").textContent,c=e.querySelector(".card__price").textContent,l=document.createElement("h3"),a=document.createElement("li"),i=document.createElement("i"),s=document.createElement("a"),u=document.createElement("img");if(priceCount+=+c.replace("$",""),priceInner.textContent=priceCount+"$",u.src=n,u.alt=r,s.textContent=o,l.classList.add("price__count"),l.textContent=c,Massive.push(o),document.getElementById("mySelect")&&popup.classList.contains("show")){let e=document.getElementById("mySelect");selectedValue=e.value,e.onchange=function(){selectedValue=e.value},selection.push(selectedValue)}selectedValue="N/C",selection.push(selectedValue);for(let e=iteration;e<Massive.length;e++)arr.push({title:Massive[e],option:selection[e]}),iteration++;const d={title:arr.map((e=>e.title+" "+e.option)).toString(),totalPrice:priceCount};localStorage.setItem("items",JSON.stringify(d)),t.classList.add("btn__delete"),i.classList.add("fas","fa-times"),a.classList.add("inner__item"),s.classList.add("item__title"),t.append(i),a.append(u,s,l,t),itemList.append(a),numberForProducts>=9?(counters[0].textContent="9+",counters[1].textContent="9+",numberForProducts++):(counters[0].textContent++,counters[1].textContent++,numberForProducts++),titleEmpty.style.display="none",btnCheckout.style.display="block",priceContainer.style.display="flex"}btnBuy.addEventListener("click",(()=>{addCart(cardContainer)}));